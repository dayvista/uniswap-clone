{"ast":null,"code":"import _objectSpread from \"/home/liam/Documents/Code/paladin/test/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"/home/liam/Documents/Code/paladin/test/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/home/liam/Documents/Code/paladin/test/src/components/fields/SwapFields.tsx\",\n    _this = this;\n\nvar __jsx = React.createElement;\nimport _regeneratorRuntime from \"/home/liam/Documents/Code/paladin/test/node_modules/@babel/runtime/regenerator\";\nimport React, { useState, useEffect } from \"react\";\nimport { removeDuplicateObjectFromArray, getErc20Balance } from \"../../lib/utils\";\nimport { HiChevronDown } from \"react-icons/hi\";\nimport TokenSwitch from \"../buttons/TokenSwitch\";\nimport { useAppSelector as useSelector, useAppDispatch as useDispatch } from \"../../lib/redux/hooks\";\nimport { modifyFromValue, modifyToValue } from \"../../lib/redux/slices/inputValues\";\nimport { modifyFromToken, modifyToToken } from \"../../lib/redux/slices/swapTokens\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { formatEther, parseEther } from \"@ethersproject/units\";\nimport \"../../styles/fields/SwapFields.css\";\n\nvar Field = function Field(_ref) {\n  var heading = _ref.heading,\n      balance = _ref.balance,\n      token = _ref.token,\n      changeToken = _ref.changeToken,\n      inputValue = _ref.inputValue,\n      changeInputValue = _ref.changeInputValue;\n  var fromToken = useSelector(function (state) {\n    return state.swapTokens.fromToken;\n  });\n  var toToken = useSelector(function (state) {\n    return state.swapTokens.toToken;\n  });\n  var dispatch = useDispatch();\n\n  var _useWeb3React = useWeb3React(),\n      account = _useWeb3React.account,\n      active = _useWeb3React.active; // Get the token balance\n\n\n  useEffect(function () {\n    if (token && token.address && !token.balance && account) {\n      _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var tokenBalance;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return getErc20Balance(token.address, account);\n\n              case 2:\n                tokenBalance = _context.sent;\n                dispatch(changeToken(_objectSpread(_objectSpread({}, token), {}, {\n                  balance: formatEther(tokenBalance)\n                })));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    }\n  }, [token, account]); // Make all token balances 'null' when the user is no longer logged into Metamask\n\n  useEffect(function () {\n    if (!active && token && token.balance) {\n      dispatch(changeToken(_objectSpread(_objectSpread({}, token), {}, {\n        balance: null\n      })));\n    }\n  }, [active]);\n\n  var getExchangeRateOnKeyUp = function getExchangeRateOnKeyUp(timeout) {\n    console.log(parseEther(inputValue));\n    clearTimeout(timeout);\n    timeout = setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              // const exchangeRate = await getExchangeRate(\n              //   parseEther(inputValue),\n              //   fromToken.address,\n              //   toToken.address\n              // );\n              // console.log(exchangeRate);\n              console.log(\"ran\");\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })), 600);\n  };\n\n  useEffect(function () {\n    var shouldCalcExchangeRate = heading.toLowerCase() === \"from\" && inputValue && fromToken && fromToken.address && toToken && toToken.address ? true : false;\n    var input = document.getElementById(\"\".concat(heading.toLowerCase(), \"-token-input\"));\n    var timeout = null;\n\n    if (input && shouldCalcExchangeRate) {\n      input.addEventListener(\"keyup\", function () {\n        return getExchangeRateOnKeyUp(timeout);\n      });\n    }\n\n    return function () {\n      if (input && shouldCalcExchangeRate) {\n        input.removeEventListener(\"keyup\", function () {\n          return getExchangeRateOnKeyUp(timeout);\n        });\n      }\n    };\n  }, [inputValue]);\n  return __jsx(\"div\", {\n    className: \"field-container\",\n    style: {\n      marginBottom: heading.toLowerCase() === \"from\" ? \"3px\" : 0\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 5\n    }\n  }, __jsx(\"p\", {\n    style: {\n      fontSize: \"14px\"\n    },\n    className: \"text bold no-select\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }\n  }, heading), __jsx(\"div\", {\n    className: \"token-button-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }, __jsx(\"button\", {\n    style: {\n      padding: token ? \"8px 16px\" : \"8px 16px 8px 5px\"\n    },\n    className: \"token-button\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }\n  }, token ? __jsx(\"img\", {\n    className: \"no-select\",\n    src: token.logoURI,\n    alt: \"\".concat(token.symbol, \" logo\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }\n  }) : null, __jsx(\"p\", {\n    className: \"no-select bold\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 11\n    }\n  }, token ? token.symbol : \"Select Token\"), __jsx(HiChevronDown, {\n    className: \"no-select\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 11\n    }\n  })), __jsx(\"input\", {\n    type: \"number\",\n    inputMode: \"decimal\",\n    placeholder: \"0.0\",\n    spellCheck: false,\n    minLength: 1,\n    maxLength: 79,\n    value: inputValue ? inputValue : \"\",\n    onChange: function onChange(e) {\n      var target = e.target;\n      var value = target.value;\n      dispatch(changeInputValue(value));\n    },\n    disabled: heading.toLowerCase() === \"to\",\n    id: \"\".concat(heading.toLowerCase(), \"-token-input\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"balance-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }\n  }, balance ? __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, __jsx(\"span\", {\n    className: \"no-select\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }, \"Balance:\"), balance.quantity === \"0.0\" || balance.quantity == \"0\" ? \"0\" : parseFloat(balance.quantity).toFixed(3), \" \", balance.symbol) : __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 11\n    }\n  })));\n};\n\nvar SwapFields = function SwapFields() {\n  var _useState = useState([]),\n      tokenList = _useState[0],\n      setTokenList = _useState[1]; // Async load the (mock) token list\n\n\n  useEffect(function () {\n    var desiredTokens = [{\n      symbol: \"WETH\",\n      address: \"0xd0A1E359811322d97991E03f863a0C30C2cF029C\"\n    }, {\n      symbol: \"AAVE\",\n      address: \"0xB597cd8D3217ea6477232F9217fa70837ff667Af\"\n    }, {\n      symbol: \"UNI\",\n      address: \"0x075A36BA8846C6B6F53644fDd3bf17E5151789DC\"\n    }, {\n      symbol: \"COMP\",\n      address: \"0x61460874a7196d6a22D1eE4922473664b3E95270\"\n    }, {\n      symbol: \"DAI\",\n      address: \"0xFf795577d9AC8bD7D90Ee22b6C1703490b6512FD\"\n    }, {\n      symbol: \"USDC\",\n      address: \"0xe22da380ee6B445bb8273C81944ADEB6E8450422\"\n    }];\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var res, json, tokens, filteredTokenList;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return fetch(\"https://gateway.ipfs.io/ipns/tokens.uniswap.org\");\n\n            case 2:\n              res = _context3.sent;\n              _context3.next = 5;\n              return res.json();\n\n            case 5:\n              json = _context3.sent;\n              tokens = json.tokens;\n              filteredTokenList = removeDuplicateObjectFromArray(tokens.filter(function (token) {\n                return desiredTokens.some(function (desiredToken) {\n                  return desiredToken.symbol === token.symbol;\n                });\n              }), \"symbol\").map(function (token) {\n                return _objectSpread(_objectSpread({}, token), {}, {\n                  address: desiredTokens.find(function (desiredToken) {\n                    return desiredToken.symbol === token.symbol;\n                  }).address\n                });\n              });\n              setTokenList(filteredTokenList);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  }, []);\n  var fromToken = useSelector(function (state) {\n    return state.swapTokens.fromToken;\n  });\n  var toToken = useSelector(function (state) {\n    return state.swapTokens.toToken;\n  });\n  var fromValue = useSelector(function (state) {\n    return state.inputValues.fromVal;\n  });\n  var toValue = useSelector(function (state) {\n    return state.inputValues.toVal;\n  });\n  var dispatch = useDispatch(); // Set the initial token values on page load\n\n  useEffect(function () {\n    // lines 259 - 261 would be the desired function if the user was able to choose a token from a modal menu\n    // if (fromToken == null && tokenList.length > 0) {\n    //   dispatch(modifyFromToken(tokenList[0]));\n    // }\n    if (tokenList.length > 0) {\n      if (fromToken == null) {\n        dispatch(modifyFromToken(tokenList[0]));\n      }\n\n      if (toToken == null) {\n        dispatch(modifyToToken(tokenList[1]));\n      }\n    }\n  }, [tokenList]);\n  return __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      position: \"relative\"\n    },\n    id: \"fields-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 5\n    }\n  }, __jsx(Field, {\n    heading: \"FROM\",\n    token: fromToken,\n    changeToken: modifyFromToken,\n    inputValue: fromValue,\n    changeInputValue: modifyFromValue,\n    balance: fromToken && (fromToken === null || fromToken === void 0 ? void 0 : fromToken.balance) ? {\n      quantity: fromToken.balance,\n      symbol: fromToken.symbol\n    } : null,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }\n  }), __jsx(Field, {\n    heading: \"TO\",\n    token: toToken,\n    changeToken: modifyToToken,\n    inputValue: toValue,\n    changeInputValue: modifyToValue,\n    balance: toToken && (toToken === null || toToken === void 0 ? void 0 : toToken.balance) ? {\n      quantity: toToken.balance,\n      symbol: toToken.symbol\n    } : null,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }\n  }), __jsx(TokenSwitch, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default SwapFields;","map":{"version":3,"sources":["/home/liam/Documents/Code/paladin/test/src/components/fields/SwapFields.tsx"],"names":["React","useState","useEffect","removeDuplicateObjectFromArray","getErc20Balance","HiChevronDown","TokenSwitch","useAppSelector","useSelector","useAppDispatch","useDispatch","modifyFromValue","modifyToValue","modifyFromToken","modifyToToken","useWeb3React","formatEther","parseEther","Field","heading","balance","token","changeToken","inputValue","changeInputValue","fromToken","state","swapTokens","toToken","dispatch","account","active","address","tokenBalance","getExchangeRateOnKeyUp","timeout","console","log","clearTimeout","setTimeout","shouldCalcExchangeRate","toLowerCase","input","document","getElementById","addEventListener","removeEventListener","marginBottom","fontSize","padding","logoURI","symbol","e","target","value","quantity","parseFloat","toFixed","SwapFields","tokenList","setTokenList","desiredTokens","fetch","res","json","tokens","filteredTokenList","filter","some","desiredToken","map","find","fromValue","inputValues","fromVal","toValue","toVal","length","display","flexDirection","position"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  removeDuplicateObjectFromArray,\n  getErc20Balance,\n  getExchangeRate,\n} from \"../../lib/utils\";\nimport { Token } from \"../../lib/types\";\nimport { HiChevronDown } from \"react-icons/hi\";\nimport TokenSwitch from \"../buttons/TokenSwitch\";\nimport { ActionCreatorWithPayload } from \"@reduxjs/toolkit\";\nimport {\n  useAppSelector as useSelector,\n  useAppDispatch as useDispatch,\n} from \"../../lib/redux/hooks\";\nimport {\n  modifyFromValue,\n  modifyToValue,\n} from \"../../lib/redux/slices/inputValues\";\nimport {\n  modifyFromToken,\n  modifyToToken,\n} from \"../../lib/redux/slices/swapTokens\";\nimport { Web3Provider } from \"@ethersproject/providers\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { formatEther, parseEther } from \"@ethersproject/units\";\n\nimport \"../../styles/fields/SwapFields.css\";\n\ntype FieldProps = {\n  heading: string;\n  token: Token;\n  changeToken: ActionCreatorWithPayload<any, string>;\n  inputValue: string;\n  changeInputValue: ActionCreatorWithPayload<any, string>;\n  balance: { quantity: string; symbol: string };\n};\nconst Field = ({\n  heading,\n  balance,\n  token,\n  changeToken,\n  inputValue,\n  changeInputValue,\n}: FieldProps) => {\n  const fromToken = useSelector((state) => state.swapTokens.fromToken);\n  const toToken = useSelector((state) => state.swapTokens.toToken);\n\n  const dispatch = useDispatch();\n\n  const { account, active } = useWeb3React<Web3Provider>();\n\n  // Get the token balance\n  useEffect(() => {\n    if (token && token.address && !token.balance && account) {\n      (async () => {\n        const tokenBalance = await getErc20Balance(token.address, account);\n\n        dispatch(changeToken({ ...token, balance: formatEther(tokenBalance) }));\n      })();\n    }\n  }, [token, account]);\n\n  // Make all token balances 'null' when the user is no longer logged into Metamask\n  useEffect(() => {\n    if (!active && token && token.balance) {\n      dispatch(changeToken({ ...token, balance: null }));\n    }\n  }, [active]);\n\n  const getExchangeRateOnKeyUp = (timeout: NodeJS.Timeout) => {\n    console.log(parseEther(inputValue));\n\n    clearTimeout(timeout);\n\n    timeout = setTimeout(async () => {\n      // const exchangeRate = await getExchangeRate(\n      //   parseEther(inputValue),\n      //   fromToken.address,\n      //   toToken.address\n      // );\n\n      // console.log(exchangeRate);\n\n      console.log(\"ran\");\n    }, 600);\n  };\n\n  useEffect(() => {\n    const shouldCalcExchangeRate =\n      heading.toLowerCase() === \"from\" &&\n      inputValue &&\n      fromToken &&\n      fromToken.address &&\n      toToken &&\n      toToken.address\n        ? true\n        : false;\n\n    const input = document.getElementById(\n      `${heading.toLowerCase()}-token-input`\n    );\n\n    let timeout = null;\n\n    if (input && shouldCalcExchangeRate) {\n      input.addEventListener(\"keyup\", () => getExchangeRateOnKeyUp(timeout));\n    }\n\n    return () => {\n      if (input && shouldCalcExchangeRate) {\n        input.removeEventListener(\"keyup\", () =>\n          getExchangeRateOnKeyUp(timeout)\n        );\n      }\n    };\n  }, [inputValue]);\n\n  return (\n    <div\n      className=\"field-container\"\n      style={{ marginBottom: heading.toLowerCase() === \"from\" ? \"3px\" : 0 }}\n    >\n      <p\n        style={{\n          fontSize: \"14px\",\n        }}\n        className=\"text bold no-select\"\n      >\n        {heading}\n      </p>\n      <div className=\"token-button-container\">\n        <button\n          style={{ padding: token ? \"8px 16px\" : \"8px 16px 8px 5px\" }}\n          className=\"token-button\"\n        >\n          {token ? (\n            <img\n              className=\"no-select\"\n              src={token.logoURI}\n              alt={`${token.symbol} logo`}\n            />\n          ) : null}\n          <p className=\"no-select bold\">\n            {token ? token.symbol : \"Select Token\"}\n          </p>\n          <HiChevronDown className=\"no-select\" />\n        </button>\n        <input\n          type=\"number\"\n          inputMode=\"decimal\"\n          placeholder=\"0.0\"\n          spellCheck={false}\n          minLength={1}\n          maxLength={79}\n          value={inputValue ? inputValue : \"\"}\n          onChange={(e) => {\n            const { target } = e;\n            const { value } = target;\n\n            dispatch(changeInputValue(value));\n          }}\n          disabled={heading.toLowerCase() === \"to\"}\n          id={`${heading.toLowerCase()}-token-input`}\n        />\n      </div>\n      <div className=\"balance-container\">\n        {balance ? (\n          <p>\n            <span className=\"no-select\">Balance:</span>\n            {balance.quantity === \"0.0\" || balance.quantity == \"0\"\n              ? \"0\"\n              : parseFloat(balance.quantity).toFixed(3)}{\" \"}\n            {balance.symbol}\n          </p>\n        ) : (\n          <div />\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst SwapFields = () => {\n  const [tokenList, setTokenList] = useState<Token[]>([]);\n\n  // Async load the (mock) token list\n  useEffect(() => {\n    const desiredTokens = [\n      { symbol: \"WETH\", address: \"0xd0A1E359811322d97991E03f863a0C30C2cF029C\" },\n      { symbol: \"AAVE\", address: \"0xB597cd8D3217ea6477232F9217fa70837ff667Af\" },\n      { symbol: \"UNI\", address: \"0x075A36BA8846C6B6F53644fDd3bf17E5151789DC\" },\n      { symbol: \"COMP\", address: \"0x61460874a7196d6a22D1eE4922473664b3E95270\" },\n      { symbol: \"DAI\", address: \"0xFf795577d9AC8bD7D90Ee22b6C1703490b6512FD\" },\n      { symbol: \"USDC\", address: \"0xe22da380ee6B445bb8273C81944ADEB6E8450422\" },\n    ];\n\n    (async () => {\n      const res = await fetch(\n        \"https://gateway.ipfs.io/ipns/tokens.uniswap.org\"\n      );\n      const json: { tokens: Token[] } = await res.json();\n      const { tokens } = json;\n\n      const filteredTokenList = removeDuplicateObjectFromArray<Token>(\n        tokens.filter((token) =>\n          desiredTokens.some(\n            (desiredToken) => desiredToken.symbol === token.symbol\n          )\n        ),\n        \"symbol\"\n      ).map((token) => {\n        return {\n          ...token,\n          address: desiredTokens.find(\n            (desiredToken) => desiredToken.symbol === token.symbol\n          ).address,\n        };\n      });\n\n      setTokenList(filteredTokenList);\n    })();\n  }, []);\n\n  const fromToken = useSelector((state) => state.swapTokens.fromToken);\n  const toToken = useSelector((state) => state.swapTokens.toToken);\n  const fromValue = useSelector((state) => state.inputValues.fromVal);\n  const toValue = useSelector((state) => state.inputValues.toVal);\n\n  const dispatch = useDispatch();\n\n  // Set the initial token values on page load\n  useEffect(() => {\n    // lines 259 - 261 would be the desired function if the user was able to choose a token from a modal menu\n\n    // if (fromToken == null && tokenList.length > 0) {\n    //   dispatch(modifyFromToken(tokenList[0]));\n    // }\n\n    if (tokenList.length > 0) {\n      if (fromToken == null) {\n        dispatch(modifyFromToken(tokenList[0]));\n      }\n\n      if (toToken == null) {\n        dispatch(modifyToToken(tokenList[1]));\n      }\n    }\n  }, [tokenList]);\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        position: \"relative\",\n      }}\n      id=\"fields-container\"\n    >\n      <Field\n        heading=\"FROM\"\n        token={fromToken}\n        changeToken={modifyFromToken}\n        inputValue={fromValue}\n        changeInputValue={modifyFromValue}\n        balance={\n          fromToken && fromToken?.balance\n            ? { quantity: fromToken.balance, symbol: fromToken.symbol }\n            : null\n        }\n      />\n      <Field\n        heading=\"TO\"\n        token={toToken}\n        changeToken={modifyToToken}\n        inputValue={toValue}\n        changeInputValue={modifyToValue}\n        balance={\n          toToken && toToken?.balance\n            ? { quantity: toToken.balance, symbol: toToken.symbol }\n            : null\n        }\n      />\n      <TokenSwitch />\n    </div>\n  );\n};\n\nexport default SwapFields;\n"]},"metadata":{},"sourceType":"module"}